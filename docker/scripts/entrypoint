#!/bin/sh
set -eu

log() {
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] $1"
}

mkdir -p /run/nginx /run/php-fpm82
mkdir -p /var/www/html/var/cache /var/www/html/var/plugins
mkdir -p /var/www/html/www/images /var/www/html/www/delivery

chown -R nginx:nginx /var/www/html /run/nginx /run/php-fpm82
chmod -R 755 /var/www/html
chmod -R 777 /var/www/html/var /var/www/html/www/images /var/www/html/www/delivery

if [ -n "${TZ:-}" ]; then
    log "Set timezone to ${TZ}"
    ln -snf "/usr/share/zoneinfo/${TZ}" /etc/localtime
    echo "${TZ}" > /etc/timezone
fi

exec "$@"
